---
import Layout from "../layouts/Layout.astro";
import Boton from "../components/ui/Boton.astro";
import Badge from "../components/ui/Badge.astro";
---

<Layout
  titulo="Contacto | Alquileres Costa del Sol"
  descripcion="¬øTienes alguna duda? Contacta con nuestro equipo para reservar tu estancia o gestionar tu propiedad en M√°laga y Marbella."
  breadcrumbs={[{ nombre: "Contacto", url: "/contacto" }]}
>
  <section class="bg-marca-clara py-24 px-4 relative overflow-hidden">
    <!-- fondo -->
    <div
      class="absolute top-0 right-0 w-96 h-96 bg-marca-primaria/5 rounded-full -mr-48 -mt-48 blur-3xl"
    >
    </div>
    <div
      class="absolute bottom-0 left-0 w-96 h-96 bg-marca-acento/5 rounded-full -ml-48 -mb-48 blur-3xl"
    >
    </div>

    <div class="max-w-7xl mx-auto relative z-10">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-20 items-center">
        <!-- contacto -->
        <div>
          <Badge variant="accent" class="mb-6">Estamos aqu√≠ para ti</Badge>
          <h1
            class="text-5xl font-extrabold text-marca-oscura mb-8 tracking-tight"
          >
            ¬øHablamos? Estamos <br /><span class="text-marca-primaria"
              >a un solo clic</span
            >
          </h1>
          <p class="text-slate-600 mb-12 text-xl leading-relaxed font-light">
            ¬øTienes dudas sobre una propiedad o quieres que gestionemos tu
            alquiler? Cu√©ntanos qu√© necesitas y nuestro equipo local te
            responder√° en menos de 24 horas.
          </p>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
            <div
              class="flex items-start gap-4 p-6 bg-white rounded-2xl shadow-sm border border-slate-100"
            >
              <div
                class="w-12 h-12 bg-marca-primaria/10 rounded-xl flex items-center justify-center text-marca-primaria text-xl"
              >
                üìç
              </div>
              <div>
                <h3 class="font-bold text-marca-oscura">Vis√≠tanos</h3>
                <p class="text-slate-500 text-sm leading-relaxed">
                  Avenida Andaluc√≠a n√∫mero 42 <br />M√°laga, 29002
                </p>
              </div>
            </div>
            <div
              class="flex items-start gap-4 p-6 bg-white rounded-2xl shadow-sm border border-slate-100"
            >
              <div
                class="w-12 h-12 bg-marca-primaria/10 rounded-xl flex items-center justify-center text-marca-primaria text-xl"
              >
                üìß
              </div>
              <div>
                <h3 class="font-bold text-marca-oscura">Escr√≠benos</h3>
                <p class="text-slate-500 text-sm leading-relaxed">
                  alquilercostadelsol2026@gmail.com
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Formulario -->
        <div class="relative">
          <div
            class="absolute inset-0 bg-marca-primaria/5 rounded-[2rem] blur-2xl -rotate-2"
          >
          </div>
          <div
            class="relative bg-white p-8 md:p-12 rounded-[2rem] shadow-2xl border border-slate-100"
          >
            <h2 class="text-2xl font-bold text-marca-oscura mb-8">
              Env√≠anos un mensaje
            </h2>
            <form id="form-contacto" class="space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-bold text-marca-oscura mb-2"
                    >Nombre Completo</label
                  >
                  <input
                    type="text"
                    name="nombre"
                    required
                    class="w-full bg-slate-50 border-transparent focus:border-marca-primaria focus:bg-white rounded-xl px-5 py-4 focus:outline-none focus:ring-4 focus:ring-marca-primaria/5 transition-all duration-300"
                    placeholder="Ej. Ana Garc√≠a"
                  />
                </div>
                <div>
                  <label class="block text-sm font-bold text-marca-oscura mb-2"
                    >Correo Electr√≥nico</label
                  >
                  <input
                    type="email"
                    name="email"
                    required
                    class="w-full bg-slate-50 border-transparent focus:border-marca-primaria focus:bg-white rounded-xl px-5 py-4 focus:outline-none focus:ring-4 focus:ring-marca-primaria/5 transition-all duration-300"
                    placeholder="ana@email.com"
                  />
                </div>
              </div>
              <div>
                <label class="block text-sm font-bold text-marca-oscura mb-2"
                  >¬øEn qu√© podemos ayudarte?</label
                >
                <textarea
                  name="mensaje"
                  rows="4"
                  required
                  class="w-full bg-slate-50 border-transparent focus:border-marca-primaria focus:bg-white rounded-xl px-5 py-4 focus:outline-none focus:ring-4 focus:ring-marca-primaria/5 transition-all duration-300"
                  placeholder="Cu√©ntanos m√°s detalles..."></textarea>
              </div>
              <Boton tipo="submit" clase="w-full py-5 shadow-marca">
                Enviar Solicitud
              </Boton>
              <p class="text-center text-xs text-slate-400 mt-4">
                Prometemos no enviarte spam. Tus datos est√°n a salvo con
                nosotros.
              </p>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script is:inline>
    const form = document.getElementById("form-contacto");
    const container = form.parentElement;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const btn = form.querySelector("button");
      const btnText = btn.innerHTML;

      // Loading State
      btn.disabled = true;
      btn.innerHTML =
        '<span class="flex items-center justify-center gap-2"><svg class="animate-spin h-5 w-5 text-white" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Enviando...</span>';

      const formData = new FormData(form);
      const data = {
        nombre: formData.get("nombre"),
        email: formData.get("email"),
        mensaje: formData.get("mensaje"),
      };

      try {
        // En producci√≥n se cargar√≠a de variables de entorno, aqu√≠ usamos el fallback com√∫n
        const STRAPI_URL = "http://localhost:1337";
        const res = await fetch(`${STRAPI_URL}/api/contactos`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ data }),
        });

        if (res.ok) {
          container.innerHTML = `
            <div class="text-center py-10 animate-fade-in">
              <div class="text-6xl mb-6">‚úÖ</div>
              <h2 class="text-3xl font-bold text-marca-oscura mb-4">¬°Mensaje Recibido!</h2>
              <p class="text-slate-600 mb-8 max-w-sm mx-auto">Gracias <strong>${data.nombre}</strong>. Hemos guardado tu consulta y te hemos enviado un correo de confirmaci√≥n a <strong>${data.email}</strong>.</p>
              <a href="/" class="inline-block bg-marca-primaria text-white px-8 py-4 rounded-xl font-bold shadow-lg hover:shadow-marca transition-all overflow-hidden">
                Volver al Inicio
              </a>
            </div>
          `;
        } else {
          const errorData = await res.json();
          console.error("Error backend:", errorData);
          throw new Error("No se pudo procesar el env√≠o");
        }
      } catch (error) {
        console.error("Error fatal:", error);
        alert(
          "Lo sentimos, ha ocurrido un error. Aseg√∫rate de que el servidor est√© activo y de haber habilitado los permisos p√∫blicos en Strapi para 'contactos'.",
        );
        btn.disabled = false;
        btn.innerHTML = btnText;
      }
    });
  </script>
</Layout>
