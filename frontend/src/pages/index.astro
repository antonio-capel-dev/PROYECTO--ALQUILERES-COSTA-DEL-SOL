---
import Layout from "../layouts/Layout.astro";

// 1. Fetch data from Strapi (Backend)
// We use the IP of the backend. In local development it's localhost:1337.
// populate=* tells Strapi to send us the images too.
let data = [];
try {
  const response = await fetch("http://localhost:1337/api/rentals?populate=*");
  const json = await response.json();
  data = json.data || [];
} catch (error) {
  console.error("Error fetching data from Strapi:", error);
}

// Note: 'data' is an array of objects.
// Each object has { id, documentId, title, price, description, etc... }
---

<Layout title="Inicio | Alquileres Costa del Sol">
  <!-- Hero Section -->
  <section class="relative bg-slate-900 py-32 px-6 overflow-hidden">
    <!-- Background Gradient/Pattern -->
    <div class="absolute inset-0 z-0 opacity-40">
      <div
        class="absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 mix-blend-multiply filter blur-3xl opacity-50 animate-pulse"
      >
      </div>
      <div
        class="absolute -top-24 -left-24 w-96 h-96 bg-cyan-500 rounded-full mix-blend-multiply filter blur-3xl opacity-30"
      >
      </div>
    </div>

    <div class="relative z-10 max-w-5xl mx-auto text-center">
      <div
        class="inline-block mb-4 px-4 py-1.5 rounded-full bg-blue-500/10 border border-blue-400/20 text-blue-300 text-sm font-semibold tracking-wide uppercase backdrop-blur-sm"
      >
        üå¥ Tu Verano Perfecto 2026
      </div>
      <h1
        class="text-5xl md:text-7xl font-extrabold text-white tracking-tight mb-8 leading-tight"
      >
        Despierta frente al <br />
        <span
          class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500"
          >Mar Mediterr√°neo</span
        >
      </h1>
      <p
        class="text-xl text-slate-300 max-w-2xl mx-auto mb-10 font-light leading-relaxed"
      >
        Desde √°ticos de lujo en M√°laga hasta villas escondidas en Nerja. Tu
        historia inolvidable empieza con una llave.
      </p>

      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href="#rentals"
          class="px-8 py-4 bg-white text-slate-900 rounded-full font-bold hover:bg-blue-50 transition transform hover:-translate-y-1 shadow-xl hover:shadow-2xl"
        >
          Ver Propiedades
        </a>
        <a
          href="#"
          class="px-8 py-4 bg-transparent border border-slate-600 text-white rounded-full font-semibold hover:bg-white/10 transition backdrop-blur-sm"
        >
          Contactar Agente
        </a>
      </div>
    </div>
  </section>

  <!-- Listings Grid -->
  <section
    id="rentals"
    class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24 bg-white"
  >
    <div class="flex justify-between items-end mb-12">
      <div>
        <h2 class="text-3xl md:text-4xl font-bold text-slate-900">
          Joyas Disponibles
        </h2>
        <p class="text-slate-500 mt-2 text-lg">
          Selecci√≥n exclusiva para esta semana
        </p>
      </div>
      <a
        href="#"
        class="hidden md:flex items-center text-blue-600 font-semibold hover:text-blue-800 transition group"
      >
        Ver todo el cat√°logo
        <span class="ml-2 transform group-hover:translate-x-1 transition"
          >‚Üí</span
        >
      </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
      {
        data.map((rental) => (
          <article class="group bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 border border-slate-100 overflow-hidden flex flex-col h-full transform hover:-translate-y-1">
            {/* Image Area */}
            <div class="relative h-64 bg-slate-200 overflow-hidden">
              <div class="absolute inset-0 flex items-center justify-center text-slate-400 group-hover:scale-105 transition duration-700 ease-out">
                {/* Placeholder since we don't have real images yet */}
                <span class="text-6xl filter grayscale group-hover:grayscale-0 transition duration-500">
                  üè°
                </span>
              </div>

              {/* Price Tag */}
              <div class="absolute top-4 right-4 bg-white/95 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg font-bold text-slate-900 border border-slate-100/50">
                {rental.price} ‚Ç¨{" "}
                <span class="text-xs text-slate-500 font-normal">/ noche</span>
              </div>
            </div>

            {/* Content */}
            <div class="p-8 flex flex-col flex-grow">
              <div class="mb-4">
                <h3 class="text-2xl font-bold text-slate-900 mb-2 group-hover:text-blue-600 transition">
                  {rental.title}
                </h3>
                <div class="flex items-center text-slate-500 text-sm">
                  <span class="mr-2">üìç</span> Costa del Sol, Espa√±a
                </div>
              </div>

              <p class="text-slate-600 mb-8 line-clamp-3 text-sm leading-relaxed flex-grow">
                {/* Fallback for description */}
                Espacio dise√±ado para el confort y el lujo. Disfruta de vistas
                inigualables y servicios premium en este alojamiento exclusivo.
              </p>

              <a
                href={`/rentals/${rental.slug || rental.documentId}`}
                class="w-full py-3.5 rounded-xl border border-slate-200 text-slate-700 font-semibold hover:bg-slate-900 hover:text-white hover:border-slate-900 transition-colors duration-300 flex justify-center items-center gap-2"
              >
                Ver Disponibilidad
              </a>
            </div>
          </article>
        ))
      }
    </div>

    {/* Empty State */}
    {
      data.length === 0 && (
        <div class="text-center py-32 bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200">
          <div class="text-6xl mb-6">üèùÔ∏è</div>
          <h3 class="text-2xl font-bold text-slate-800 mb-2">
            No hay propiedades visibles
          </h3>
          <p class="text-slate-500 max-w-md mx-auto mb-8">
            Parece que Strapi no est√° enviando datos o la colecci√≥n est√° vac√≠a.
            ¬°A√±ade tu primer piso en el panel de control!
          </p>
          <a href="#" class="text-blue-600 font-semibold hover:underline">
            Ir al CMS ‚Üí
          </a>
        </div>
      )
    }
  </section>
</Layout>
