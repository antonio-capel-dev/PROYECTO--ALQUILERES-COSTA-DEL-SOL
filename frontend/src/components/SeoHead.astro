---
import { getLangFromUrl } from "../i18n/utils";

export interface Props {
  titulo?: string;
  descripcion?: string;
  imagen?: string;
  urlCanonica?: string | URL;
  robots?: string;
  tipo?: "website" | "article";
  urlPrevia?: string | URL;
  urlSiguiente?: string | URL;
  faq?: { pregunta: string; respuesta: string }[];
  breadcrumbs?: { nombre: string; url: string }[];
  alternateLinks?: { lang: string; url: string }[];
}

const {
  titulo = "Alquileres Costa del Sol | Apartamentos y Pisos Vacacionales",
  descripcion = "Encuentra tu alquiler ideal en la Costa del Sol. Apartamentos en Marbella, pisos en Málaga, y casas vacacionales al mejor precio.",
  imagen = "/images/og-default.jpg",
  urlCanonica = new URL(Astro.url.pathname, Astro.site),
  robots = "index, follow",
  tipo = "website",
  urlPrevia,
  urlSiguiente,
  faq = [],
  breadcrumbs = [],
  alternateLinks = [],
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const OG_LOCALE: Record<string, string> = {
  es: "es_ES",
  en: "en_US",
  fr: "fr_FR",
};
const ogLocale = OG_LOCALE[lang] ?? "es_ES";

const siteName = "Alquileres Costa del Sol";
const twitterHandle = "@alquileres_costasol";
---

<!-- Metadatos globales -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<meta name="generator" content={Astro.generator} />

<!--url canonical  -->
<link rel="canonical" href={urlCanonica} />
{urlPrevia && <link rel="prev" href={urlPrevia} />}
{urlSiguiente && <link rel="next" href={urlSiguiente} />}

<!-- Hreflang Tags -->
{
  alternateLinks.map((link) => (
    <link rel="alternate" hreflang={link.lang} href={link.url} />
  ))
}

<title>{titulo}</title>
<meta name="title" content={titulo} />
<meta name="description" content={descripcion} />
<meta name="author" content="Antonio Capel" />
<meta name="robots" content={robots} />

<meta property="og:type" content={tipo} />
<meta property="og:url" content={Astro.url} />
<meta property="og:title" content={titulo} />
<meta property="og:description" content={descripcion} />
<meta property="og:image" content={new URL(imagen, Astro.url)} />
<meta property="og:site_name" content={siteName} />
<meta property="og:locale" content={ogLocale} />

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:url" content={Astro.url} />
<meta property="twitter:title" content={titulo} />
<meta property="twitter:description" content={descripcion} />
<meta property="twitter:image" content={new URL(imagen, Astro.url)} />
<meta property="twitter:creator" content={twitterHandle} />

<link rel="sitemap" href="/sitemap-index.xml" />

<!-- JSON-LD Schema: The Secret Sauce for Google -->
<script
  type="application/ld+json"
  set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "@id": "https://alquileres-costadelsol.com/#website",
        url: "https://alquileres-costadelsol.com",
        name: "Alquileres Costa del Sol",
        description:
          "Marketplace líder de alquileres en Málaga y Costa del Sol.",
        inLanguage: "es-ES",
      },
      {
        "@type": "Organization",
        "@id": "https://alquileres-costadelsol.com/#organization",
        name: "Alquileres Costa del Sol",
        url: "https://alquileres-costadelsol.com",
        logo: {
          "@type": "ImageObject",
          url: "https://alquileres-costadelsol.com/favicon.svg",
        },
        sameAs: [
          "https://twitter.com/alquileres_costasol",
          "https://www.instagram.com/alquileres_costasol",
        ],
      },
      {
        "@type": "LocalBusiness",
        "@id": "https://alquileres-costadelsol.com/#localbusiness",
        name: "Alquileres Costa del Sol",
        image: "https://alquileres-costadelsol.com/favicon.svg",
        url: "https://alquileres-costadelsol.com",
        telephone: "+34612345678",
        priceRange: "$$",
        address: {
          "@type": "PostalAddress",
          streetAddress: "Calle Larios 1",
          addressLocality: "Málaga",
          postalCode: "29005",
          addressCountry: "ES",
        },
        geo: {
          "@type": "GeoCoordinates",
          latitude: 36.7212,
          longitude: -4.4217,
        },
        openingHoursSpecification: {
          "@type": "OpeningHoursSpecification",
          dayOfWeek: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
          opens: "09:00",
          closes: "18:00",
        },
      },
      {
        "@type": "BreadcrumbList",
        itemListElement: [
          {
            "@type": "ListItem",
            position: 1,
            name: "Inicio",
            item: "https://alquileres-costadelsol.com",
          },
          ...breadcrumbs.map((b, i) => ({
            "@type": "ListItem",
            position: i + 2,
            name: b.nombre,
            item: b.url.startsWith("http")
              ? b.url
              : `https://alquileres-costadelsol.com${b.url}`,
          })),
        ],
      },
      faq.length > 0 && {
        "@type": "FAQPage",
        mainEntity: faq.map((f) => ({
          "@type": "Question",
          name: f.pregunta,
          acceptedAnswer: {
            "@type": "Answer",
            text: f.respuesta,
          },
        })),
      },
    ].filter(Boolean),
  })}
/>
