---
import { IMAGENES_ZONA, IMAGEN_ZONA_FALLBACK } from "../config/zonas";

interface Props {
  nombre: string;
  slug: string;
  imagen?: { url: string };
  propiedadesCount?: number;
}

const { nombre, slug, imagen, propiedadesCount } = Astro.props;

const STRAPI = import.meta.env.PUBLIC_STRAPI_URL || "http://localhost:1337";

// â”€â”€ LÃ“GICA DE PRIORIDAD DE IMAGEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 1. Imagen de zona en Strapi (campo imagen del Content Type ubicacion)
// 2. Mapa curado en config/zonas.ts (idÃ©ntico al usado en ZoneCard de Home)
// 3. Fallback genÃ©rico premium

const cleanSlug = slug?.toLowerCase().trim();

let bgImage: string;

if (imagen?.url) {
  bgImage = imagen.url.startsWith("http") ? imagen.url : `${STRAPI}${imagen.url}`;
} else {
  bgImage = IMAGENES_ZONA[cleanSlug] ?? IMAGEN_ZONA_FALLBACK;
}
---

<div
  class="relative h-[55vh] min-h-[400px] flex items-center justify-center overflow-hidden bg-slate-900"
>
  {/* IMAGEN DE FONDO */}
  <img
    src={bgImage}
    alt={`Alquiler vacacional en ${nombre}`}
    class="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-700 ease-in-out"
    onload="this.classList.remove('opacity-0')"
    onerror={`this.src='${IMAGEN_ZONA_FALLBACK}'`}
    loading="eager"
    width="1920"
    height="550"
  />

  {/* OVERLAY DE LEGIBILIDAD (bg-black/40 REQUERIDO) */}
  <div class="absolute inset-0 bg-black/40 z-10"></div>

  {/* CONTENIDO CENTRADO */}
  <div
    class="relative z-20 text-center px-4 max-w-5xl mx-auto animate-fade-in-up"
  >
    <div
      class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-white text-xs font-bold uppercase tracking-wider mb-6"
    >
      <span>ğŸ“</span> Destino Costa del Sol
    </div>

    <h1
      class="text-4xl md:text-6xl lg:text-7xl font-black text-white mb-6 leading-tight drop-shadow-2xl"
    >
      {nombre}
    </h1>

    {
      propiedadesCount !== undefined && (
        <p class="text-lg md:text-2xl text-slate-100 font-medium drop-shadow-md">
          {propiedadesCount} alojamientos exclusivos disponibles
        </p>
      )
    }
  </div>
</div>
