---
import SeoHead from "../components/SeoHead.astro";
import Boton from "../components/ui/Boton.astro";
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import { NAV_ITEMS, FOOTER_LINKS } from "../config/navigation";
import "../styles/global.css";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const {
  titulo,
  descripcion,
  imagen,
  urlPrevia,
  urlSiguiente,
  faq,
  breadcrumbs,
} = Astro.props;

// Helper para rutas localizadas (simple por ahora)
const getPath = (href: string) => {
  if (lang === "es") return href;
  return `/${lang}${href}`;
};
---

<!doctype html>
<html lang={lang}>
  <head>
    <SeoHead
      titulo={titulo}
      descripcion={descripcion}
      imagen={imagen}
      urlPrevia={urlPrevia}
      urlSiguiente={urlSiguiente}
      faq={faq}
      breadcrumbs={breadcrumbs}
    />
    <!-- Preload critical fonts for LCP -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      as="style"
    />
    <slot name="preload" />
    <slot name="head" />
  </head>
  <body
    class="bg-marca-clara flex flex-col min-h-screen selection:bg-marca-primaria/10 selection:text-marca-primaria"
  >
    <nav
      class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-slate-100"
    >
      <div class="contenedor-fluido">
        <div class="flex justify-between items-center h-20">
          <!-- Logo -->
          <div class="flex-shrink-0 flex items-center gap-2">
            <span class="text-3xl">â˜€ï¸</span>
            <a
              href={getPath("/")}
              class="text-2xl font-bold bg-linear-to-r from-marca-primaria to-marca-acento bg-clip-text text-transparent hover:opacity-80 transition"
            >
              Costa del Sol
            </a>
          </div>

          <div class="hidden md:flex items-center space-x-8">
            {
              NAV_ITEMS.map((item) => (
                <a
                  href={getPath(item.href)}
                  class="text-slate-600 hover:text-marca-primaria font-medium transition duration-150"
                >
                  {t(item.key)}
                </a>
              ))
            }

            <!-- Selector de Idioma -->
            <div
              class="flex items-center gap-2 text-sm font-medium border-l border-slate-200 pl-6 ml-2"
            >
              <a
                href="/"
                class={`transition ${lang === "es" ? "text-marca-primaria font-bold" : "text-slate-400 hover:text-marca-primaria"}`}
                title="EspaÃ±ol">ğŸ‡ªğŸ‡¸ ES</a
              >
              <a
                href="/en"
                class={`transition ${lang === "en" ? "text-marca-primaria font-bold" : "text-slate-400 hover:text-marca-primaria"}`}
                title="English">ğŸ‡¬ğŸ‡§ EN</a
              >
              <a
                href="/fr"
                class={`transition ${lang === "fr" ? "text-marca-primaria font-bold" : "text-slate-400 hover:text-marca-primaria"}`}
                title="FranÃ§ais">ğŸ‡«ğŸ‡· FR</a
              >
            </div>

            <Boton
              href={getPath("/contacto")}
              variante="secundario"
              tamano="peque"
            >
              {t("nav.reserve")}
            </Boton>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow">
      <slot />
    </main>

    <!-- Footer -->
    <footer class="bg-marca-oscura text-slate-300 border-t border-slate-800">
      <div class="contenedor-fluido py-12">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div class="col-span-1">
            <span class="text-2xl mb-4 block">â˜€ï¸</span>
            <p class="text-sm leading-relaxed text-slate-400">
              {t("hero.desc")}
            </p>
          </div>

          <div>
            <h3 class="text-xl font-bold text-white mb-4">
              {t("footer.company")}
            </h3>
            <ul class="space-y-2 text-slate-300">
              {
                FOOTER_LINKS.company.map((link) => (
                  <li>
                    <a
                      href={getPath(link.href)}
                      class="hover:text-marca-acento transition"
                    >
                      {t(link.key as any)}
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold text-white mb-4">
              {t("destinations.title")} ğŸš€
            </h3>
            <ul class="space-y-2 text-slate-300">
              {
                FOOTER_LINKS.destinations.map((dest) => (
                  <li>
                    <a
                      href={getPath(dest.href)}
                      class="hover:text-marca-acento decoration-marca-acento underline-offset-4 hover:underline transition"
                    >
                      {dest.label}
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold text-white mb-4">
              {t("footer.contact")}
            </h3>
            <p class="text-slate-300">ğŸ“§ info@costadelsol.com</p>
            <p class="text-slate-300">ğŸ“ +34 612 345 678</p>
            <p class="text-sm text-slate-400 mt-4 italic">
              ğŸ“ Calle Larios 1, 29005 MÃ¡laga, EspaÃ±a.<br />
              Oficina registrada: B-12345678
            </p>
          </div>
        </div>
      </div>
      <div
        class="border-t border-slate-800 mt-8 py-8 text-center text-slate-500"
      >
        <p>
          &copy; {new Date().getFullYear()} Costa del Sol. {t("footer.rights")}
        </p>
      </div>
    </footer>
  </body>
</html>
