---
import SeoHead from "../components/SeoHead.astro";
import Boton from "../components/ui/Boton.astro";
import Contenedor from "../components/ui/Contenedor.astro";
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import { NAV_ITEMS, NAV_ZONAS, FOOTER_LINKS } from "../config/navigation";
import "../styles/global.css";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const {
  titulo,
  descripcion,
  imagen,
  urlPrevia,
  urlSiguiente,
  faq,
  breadcrumbs,
} = Astro.props;

// Helper para rutas localizadas (simple por ahora)
const getPath = (href: string) => {
  if (lang === "es") return href;
  return `/${lang}${href}`;
};
---

<!doctype html>
<html lang={lang}>
  <head>
    <SeoHead
      titulo={titulo}
      descripcion={descripcion}
      imagen={imagen}
      urlPrevia={urlPrevia}
      urlSiguiente={urlSiguiente}
      faq={faq}
      breadcrumbs={breadcrumbs}
    />
    <!-- Preload critical fonts for LCP -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      as="style"
    />
    <slot name="preload" />
    <slot name="head" />
  </head>
  <body
    class="bg-marca-clara flex flex-col min-h-screen selection:bg-marca-primaria/10 selection:text-marca-primaria"
  >
    <nav
      class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b"
      style="border-color: var(--color-borde)"
    >
      <Contenedor>
        <div class="flex justify-between items-center h-20">
          <!-- Logo -->
          <div class="flex-shrink-0 flex items-center gap-2">
            <span class="text-3xl">â˜€ï¸</span>
            <a
              href={getPath("/")}
              class="text-2xl font-bold bg-linear-to-r from-marca-primaria to-marca-acento bg-clip-text text-transparent hover:opacity-80 transition"
            >
              Costa del Sol
            </a>
          </div>

          <div class="hidden md:flex items-center space-x-8">
            {
              NAV_ITEMS.map((item) => (
                <a
                  href={getPath(item.href)}
                  style="color: var(--color-texto-secundario)"
                  class="hover:text-marca-primaria font-medium transition duration-150"
                >
                  {t(item.key as any)}
                </a>
              ))
            }

            <!-- Dropdown Zonas (SILO Architecture) -->
            <div class="group relative">
              <button
                style="color: var(--color-texto-secundario)"
                class="hover:text-marca-primaria font-medium transition duration-150 flex items-center gap-1"
              >
                {t("nav.zonas" as any)}
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  ><path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"></path></svg
                >
              </button>
              <div
                class="absolute left-0 mt-2 w-48 bg-white border shadow-xl rounded-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50 pointer-events-none group-hover:pointer-events-auto"
                style="border-color: var(--color-borde)"
              >
                <div class="py-2">
                  {
                    NAV_ZONAS.map((zona) => (
                      <a
                        href={getPath(zona.href)}
                        class="block px-4 py-2 text-sm hover:bg-slate-50 hover:text-marca-primaria transition-colors"
                        style="color: var(--color-texto-secundario)"
                      >
                        {zona.label}
                      </a>
                    ))
                  }
                </div>
              </div>
            </div>

            <!-- Selector de Idioma -->
            <div
              class="flex items-center gap-2 text-sm font-medium border-l pl-6 ml-2"
              style="border-color: var(--color-borde)"
            >
              <a
                href="/"
                class={`transition ${lang === "es" ? "text-marca-primaria font-bold" : "hover:text-marca-primaria"}`}
                style={lang !== "es" ? "color: var(--color-texto-mutado)" : ""}
                title="EspaÃ±ol">ğŸ‡ªğŸ‡¸ ES</a
              >
              <a
                href="/en"
                class={`transition ${lang === "en" ? "text-marca-primaria font-bold" : "hover:text-marca-primaria"}`}
                style={lang !== "en" ? "color: var(--color-texto-mutado)" : ""}
                title="English">ğŸ‡¬ğŸ‡§ EN</a
              >
              <a
                href="/fr"
                class={`transition ${lang === "fr" ? "text-marca-primaria font-bold" : "hover:text-marca-primaria"}`}
                style={lang !== "fr" ? "color: var(--color-texto-mutado)" : ""}
                title="FranÃ§ais">ğŸ‡«ğŸ‡· FR</a
              >
            </div>

            <Boton
              href={getPath("/contacto")}
              variante="secundario"
              tamano="peque"
            >
              {t("nav.reserve")}
            </Boton>
          </div>
        </div>
      </Contenedor>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow">
      <slot />
    </main>

    <!-- Footer -->
    <footer
      class="bg-marca-oscura text-marca-clara border-t border-marca-oscura"
    >
      <Contenedor className="py-12">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div class="col-span-1">
            <span class="text-2xl mb-4 block">â˜€ï¸</span>
            <p
              style="color: var(--color-texto-mutado)"
              class="text-sm leading-relaxed"
            >
              {t("hero.desc")}
            </p>
          </div>

          <div>
            <h3 class="text-xl font-bold text-white mb-4">
              {t("footer.company")}
            </h3>
            <ul class="space-y-2" style="color: var(--color-texto-mutado)">
              {
                FOOTER_LINKS.company.map((link) => (
                  <li>
                    <a
                      href={getPath(link.href)}
                      class="hover:text-marca-acento transition"
                    >
                      {t(link.key as any)}
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold text-white mb-4">
              {t("destinations.title")} ğŸš€
            </h3>
            <ul class="space-y-2" style="color: var(--color-texto-mutado)">
              {
                FOOTER_LINKS.destinations.map((dest) => (
                  <li>
                    <a
                      href={getPath(dest.href)}
                      class="hover:text-marca-acento decoration-marca-acento underline-offset-4 hover:underline transition"
                    >
                      {dest.label}
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold text-white mb-4">
              {t("footer.contact")}
            </h3>
            <p style="color: var(--color-texto-mutado)">
              ğŸ“§ info@costadelsol.com
            </p>
            <p style="color: var(--color-texto-mutado)">ğŸ“ +34 612 345 678</p>
            <p
              style="color: var(--color-texto-mutado)"
              class="text-sm mt-4 italic opacity-75"
            >
              ğŸ“ Calle Larios 1, 29005 MÃ¡laga, EspaÃ±a.<br />
              Oficina registrada: B-12345678
            </p>
          </div>
        </div>
      </Contenedor>
      <div
        style="border-top: 1px solid color-mix(in srgb, var(--color-fondo) 20%, transparent); color: var(--color-texto-mutado)"
        class="mt-8 py-8 text-center text-sm"
      >
        <p>
          &copy; {new Date().getFullYear()} Costa del Sol. {t("footer.rights")}
        </p>
      </div>
    </footer>
  </body>
</html>
